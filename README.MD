# 爬取NPR早间新闻简报并自动更新至个人网站

## 描述
使用Python从NPR网站爬取最近的早间新闻简报，经过清洗、翻译后，更新到个人网站https://zhurong.link/english页面（page），并自动创建相应日期的文章（post）。

## 安装
1. 安装所有必要的Python库：os,requests,datetime,re,json,logging,argparse,time,bs4,selenium,webdriver,wordloud,matplotlib,collections,shutil
2. 设置环境变量：
按项目需要，设置分节的配置变量
wordpress节，nprnew节，dataclean节，update页面节等
WP_USERNAME,WP_APP_PASSWORD,WP_API_UTL,PAGE_ID

## 使用
 `news_scraper.py` (v1.6.3)以爬取新闻
 `data_clean.py` (v1.6.1)数据清洗
 `news_translator.py` (v1.6.2)使用deepl或者微软API翻译
 `wordpress_utils.py` (v1.2.0)和个人wordpress网站有关的功能。
 `wordpress_updater.py` (v1.2.0) 更新WordPress页面。

## 文件清单
- `news_scraper.py`: 新闻爬取模块。
- `data_clean.py`：数据清洗模块。
- `news_translator.py`：新闻稿翻译模块
- `wordpress_utils.py`: WordPress网站相关功能模块。
- `wordpress_updater.py`: WordPress页面更新模块。
- `config.env`：环境变量及用户密钥。
- `config_loader.env`：加载环境变量。
- `.gitignore`：git管理的忽略文件
- `README.MD`:本介绍文件

## 更新日志
### new_translator.py
#### 1.6.1 主要改动:20231006
1. 修订代码，移除部分重复和错误代码
#### 1.6.0 主要改动:
1. 优化了NewsTranslator类的初始化方法，移除了不必要的属性和参数，使其更加简洁。
2. 移除了与Azure相关的冗余代码和属性，现在Azure的配置完全依赖于AzureTranslator类。
3. 优化了代码结构，提高了代码的可读性和维护性。
#### 1.5.1 主要改动:
1. 修订Azure参数
#### 1.5.0 主要改动:
1. 添加Azure翻译接口
2. 因百度接口单词上传字符太少（5000），放弃百度接口
#### 1.4.0 主要改动:
1. 添加了百度翻译接口。
2. 设置了多种翻译接口的使用顺序。
3. 移除了不必要的参数，使得代码更为简洁。
4. 对 BaiduTranslator 类进行了重构，使其更为独立，不再依赖于外部的配置参数。
#### 1.3.3 主要改动:
1. 为NewsTranslator类添加了专用的日志记录器，使其能够将日志信息保存到指定的日志文件中。
2. 在翻译前，现在会检查DeepL API的使用情况，以确保不超过月度字符限制。
3. 增加了对API请求和响应的异常处理，以捕获和记录可能的错误。
4. 进行了一些代码重构，使其更加模块化和易于维护。
5. 添加了一个测试模式，允许用户仅翻译摘要，而不是完整的内容，以节省API调用。
6. 引入了ConfigLoader类，用于从配置文件加载配置信息。
7. 移除了一些冗余的代码和不再使用的导入。
8. 增加了对配置文件缺失的错误处理。
#### 1.3.0 主要改动:
1. API URL更新：更新了DeepL API的URL，以适应其最新的版本。
2. 性能优化：对翻译功能进行了一些优化，提高了其响应速度。
3. 用户反馈：在翻译过程中，现在会向用户显示更多的反馈信息，如剩余的字符数。
4. 多语言支持：现在支持将新闻数据翻译成多种目标语言。
5. 代码结构调整：进行了一些代码重构，使其更加模块化。
6. 文档更新：更新了代码的注释和文档，提供了更详细的使用说明。
#### 1.2.0 主要改动:
1.实现了基本的新闻数据翻译功能，使用DeepL API进行翻译。
2.简单的错误处理：添加了基本的错误处理，以捕获和处理可能的异常。
3.配置管理：允许用户通过配置文件管理API密钥和其他相关设置。
#### 1.1.0 主要改动:
1. 测试模式: 在代码中添加了一个测试模式，该模式仅翻译标题或摘要以进行快速测试。这可以通过设置test_mode变量为True或False来控制。
2. 环境变量整合: 所有相关的配置项（如API URL、输入/输出文件路径、目标语言、API密钥等）现在都从config.env文件中读取，使得配置更为集中和方便。
3. 字符限制检查: 在每次翻译前，程序会检查日志以确定本月已翻译的字符数，以确保不超过DeepL API的免费层限制（500,000字符）。
4. 日志更新: 现在，每次翻译完成后，都会在日志中记录已翻译的字符数，以便用户随时查看。
5. 用户提示: 在代码中增加了更多的用户提示，以提供更好的用户体验。
6. 文件路径更新: 根据用户的要求，日志文件现在保存在d:\program\log中，翻译后的文件保存在d:\program\news中。
7. 关联清洗文件和翻译文件: 为了便于后期将中英文新闻内容同时发送到web页面，已确保清洗文件和翻译文件之间的关联性。
#### 1.0.0 主要改动:（20231003）
1. 初始版本。实现了基本的数据翻译功能。

### data_clean.py
#### 1.6.0 主要改动：
1. 修改了DataCleaner类的初始化，现在从环境变量中获取目录路径，而不是使用硬编码的默认值。
2. 在整个代码中确保一致使用audio_link变量，替换了link的实例。
3. 增强了对缺失或不一致数据的错误处理和日志记录。
4. 调整了DataCleaner类的实例化，以使用环境变量中的目录路径。
#### 1.5.0 主要改动：
1. 为了解决特殊字符问题，多种尝试对特殊字符特殊处理，最后决定只处理特殊字符，不再替换主持人的名字。
#### 1.4.0 主要改动：
1. 增加了从`config.env`中读取日志目录和文件名的功能。
2. 优化了代码的结构，使其更加模块化和易于管理。
3. 修复了一些已知的问题和潜在的错误。
#### 1.3.0 主要改动:(20231002)
1. 移除了生成summary.txt的功能。
2. 通过排除主持人姓名来增强词云生成。
3. 防止为重复和不完整的数据生成空文件。
#### 1.2.1 主要改动:(20231002)
1. 修复了数据加载问题。
2. 调整了目录结构，以实现更好的组织。
#### 1.2.0 主要改动:(20231002)
1. 更新了默认的输入文件路径，以匹配新的目录结构。
2. 更新了日志配置，使其与爬取新闻代码的日志配置一致。
3. 使用dotenv库加载config.env中的配置。
4. 修复了日期验证的问题。
5. 实现了词云生成功能。
#### 1.1.0 主要改动:（20231001）
1. 增加了处理缺失数据的功能。
2. 加强了重复数据检测机制。
3. 引入了日志记录，以便更好地追踪错误。
#### 1.0.0 主要改动:2023年9月30日
1. 初始版本。实现了基本的数据清洗功能。

### news_scraper.py
#### 1.6.1 主要改动
1. 修复了从"config.env"文件中读取参数的问题。
#### 1.6.0 主要改动
1. 引入dotenv库，正式启用外部环境变量文件config.env，保存必要参数
2. 优化了代码结构，使其更加模块化和易于维护
#### 1.5.1 主要改动
1. 在get_news_links函数中，您使用了fetch_web_page函数来加载新闻存档页面。
2. 在get_news_details和save_news_details函数中，您对错误日志的记录进行了优化，只记录错误消息的第一行。
3. 在save_to_json函数中，您更新了日志消息，提供了更详细的信息。
Bug修复：修复了当用户申请新闻数量<5时的程序逻辑。
#### 1.5.0 主要改动
1. 更改了数据库记录文件的方式，按爬取新闻的月份保存文档
2. 存盘前检查是否已有相同数据，如有则跳过，但日志中记录
#### 1.4.0 主要改动- 2023年10月2日
1. 优化了get_news_links函数，使其更加稳定和准确地获取新闻链接。
2. 修改了日志记录，使其更加清晰和有用。
3. 使用环境变量文件。
#### 1.3.5 主要改动
1. 移除了 `--directory` 参数，现在所有文件都会保存在固定的子目录中。
2. 优化了代码结构，清理了无用的代码和注释。
3. 修复了一些可能的错误和异常处理。
4. 更新了日志和输出信息，使其更加清晰和准确。
#### 1.3.4 主要改动：
1. 移除了setup_logging方法，因为日志配置已经在__init__方法中完成。
2. 将__init__方法中的默认参数值移除，现在这些值完全由argparse处理，避免了代码中的重复和硬编码。
3. 优化了save_news_details方法，现在summary.txt文件仅包含日期、摘要和对应的mp3文件名，作为一个简单的索引。
4. 优化了错误处理和日志记录，更准确地捕获和记录了可能出现的错误和异常。
5. 优化了用户输入处理，现在用户可以更灵活地通过命令行参数指定工作目录和需要爬取的新闻数量，而不需要修改代码。
6. 修正了目录创建的逻辑，现在所有新建的子目录都会在用户指定的工作目录下创建，而不是硬编码的临时目录。
#### 1.3.3 主要改动
1. 移除了不必要的setup_logging方法，简化了代码结构。
2. 修正了日志配置，现在日志文件会被正确地保存在log子目录下。
#### 1.3.2 主要改动
1. 为了更好地组织项目文件，我们在项目的主目录下创建了三个子目录：log用于存储日志文件，mp3用于存储下载的音频文件，news用于存储下载的新闻数据（JSON文件）。
2. 所有的日志文件现在都会被存储在log子目录下，所有的音频文件现在都会被存储在mp3子目录下，所有的新闻数据现在都会被存储在news子目录下，包括summary.txt和news_data.json。
3. 对save_to_json方法中的文件打开语句进行了修正，确保JSON文件能被正确地保存到news子目录下。
4. 更新了save_to_json方法中的日志信息，现在它会显示实际的文件路径，以便于跟踪。
5. Bug修复：修复了一个导致JSON文件无法被正确保存的错误。
#### 1.3.1 主要改动:
1. 增加了debug模式，可以通过命令行参数指定。
2. 所有调试语句均使用logging.debug()方法，可以通过命令行参数指定是否启用。
#### 1.3.0 主要改动:
1. 增加了命令行参数支持，允许用户通过命令行指定下载目录和新闻数量。
2. 为未来可能的Web接口预留了空间，可以方便地从Web请求中获取参数。
#### 1.2.0 主要改动:
1. 增加了状态跟踪，以便于管理和跟踪整个应用的完成率状态。
2. 完善了错误处理和日志记录功能。
3. 优化了代码结构，提高了代码的可读性和可维护性。
#### 1.1.0 主要改动:
1. 实现了模块化和解耦。
2. 加入了错误处理和日志记录。
3. 将数据存储为本地json格式。
#### v1.0 - 2023年9月27日
- 初始版本，实现了基本功能。

## 贡献
如有任何问题或建议，请通过[这里](链接)联系我。

## 许可证
此项目使用MIT许可证。

## 联系
- Email: admin@zhurong.link
- ...

